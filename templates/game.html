<html>
  <script
src="https://code.jquery.com/jquery-3.2.1.min.js"
integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
crossorigin="anonymous"></script>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>

  <body>
    <div>
      User name: <input type='text' id='username'>
      <br/>
      Game to join: <input type='text' id='game-id'>
      <br/>
      <button id='btn-join-game'>Join game</button>
      <br/>
      <button id='btn-start-game'>Start new game</button>
      <br/>
      <button id='btn-send-move'>Send move</button>
      <br/>
      <button id='btn-leave-game'>Leave game</button>
    </div>

    <div>
      <p>Game log:</p>
      <ol id='game-log'>
      </ol>
    </div>
  </body>

  <script type="text/javascript" charset="utf-8">

// Connect to the websocket server.
var socket = io.connect('http://' + document.domain + ':' + location.port);
socket.on('connect', function(data) {
  console.log('Connected!');
});

var username;
var game_id;
var players = [];

$('#btn-join-game').click(function() {
  username = $('#username').val();
  game_id = $('#game-id').val();

  var data = {username: username, game_id: game_id};
  console.log('Sending join request:');
  console.log(data);
  socket.emit('join', data);
});

socket.on('on_lobby_update', function(data) {
  console.log('Received lobby update. Current lobby state:');
  console.log(data)
  players = data['players'].slice();
  $('#game-log').empty();
});

$('#btn-start-game').click(function() {
  if (players.length == 4) {
    console.log('Sending start game request');
    socket.emit('start_game', {});
  }
});

socket.on('on_start_game', function(data) {
  console.log('Received new game:');
  console.log(data);
  $('#game-log').empty();
  $('#game-log').append('<li>' + data + '</li>');
});

socket.on('on_game_update', function(data) {
  console.log('Received game update:');
  console.log(data);
  $('#game-log').append('<li>' + data + '</li>');
});


$('#btn-send-move').click(function() {
  var data = {move: username + ' made a move'};
  console.log('Sending move request:');
  console.log(data);
  socket.emit('make_move', data);
});

$('#btn-leave-game').click(function() {
  console.log('Sending leave game request:');
  socket.emit('leave', {});
  $('#game-log').empty();
});

  </script>

</html>
